# Внедрение редактора во внешний интернет-магазин
Любой редактор сервиса Pixlpark (включая механизм выбора шаблонов или принтов) может быть встроен во внешний интернет-магазин с небольшой доработкой последнего.<br>
Пример такой интеграции можно посмотреть на сайте [puzzlesprint.com](https://puzzlesprint.com/custom-puzzles/).
Рассмотрим порядок действий для выполнения подобной задачи.

## Общий алгоритм
1. Администратор в панели управления Pixlpark создает необходимый товар, который имеет свою уникальную ссылку в редактор.

2. Администратор в магазине создает страницу товара, размещая в ней iframe со ссылкой в редактор из п.1.

3. Клиент заходит в карточку товара магазина, тем самым запуская онлайн-редактор.

4. Клиент в онлайн-редакторе создает дизайн товара, нажимает кнопку "Продолжить", а после перенаправляется в корзину магазина, где уже находится заказываемый им товар.

5. Клиент завершает оформление заказа в магазине.

6. Администратору приходит уведомление от Pixlpark о поступившем заказе. Уведомление содержит общую информацию, а также ссылки на архив заказа и страницу заказа в панели управления Pixlpark.

![](../_media/dev/iframe-editor.png ':size=70%')

## Техническая интеграция
1. Для динамического подключения редактора через iframe (формирования корректной ссылки) к разным продуктам интернет-магазина необходимо программно получать информацию о товарах и категориях, созданных в сервисе Pixlpark. Для этого можно использовать API, работа с которым описана в [соседнем разделе](/dev/api.md).<br>
Метод API `Products / GetProductCategoriesList` возвращает категории печати, `Products / GetProductsListByCategory` - продукты категории, а `Templates / GetTemplateSets` - доступные шаблоны.

2. Для обмена данными между онлайн-редактором (сервисом Pixlpark) небходимо:<br>
    2.1. К магазину подключить библиотеку jquery, а также плагин [jQuery postMessage](http://benalman.com/projects/jquery-postmessage-plugin/).<br>
    2.2. В панель управления Pixlpark в раздел `CMS / Сервисы` в поле "Скрипт, размещаемый в нижней части сайта" разместить код:
    ```html	
    <script type ="text/javascript" src="/content/js/jquery.ba-postmessage.min.js"></script>
    <script>
    $(document).ready(function () {
        if ($('.shopping-cart-container').length > 0) {
            $.postMessage($('#shoppingCartUser').val(), "http://yoursite.com/test", window.frames['pixlpark_frame']);
        }
    });
    //  http://yoursite.com/test – страница Сайта, обрабатывающая запрос от Сервиса
    </script>
    ```
    2.3. На страницах магазина разместить код:
    ```html						
    <script type="text/javascript">
    $(document).ready(function () {
        /* Обработка сообщения, полученного из iframe */
        $.receiveMessage(function (e) {
            var userId = e.data;
            // после этого можно закрыть iframe и сделать запрос по API к Сервису для получения информации о заказанном товаре
        });
    });
    </script>
    ```		
						
3. После создания дизайна и нажатии кнопки "Продолжить" в онлайн-редакторе сервис Pixlpark отправляет сообщение с Id-пользователя в магазин. На стороне интернет-магазина необходимо закрыть iframe с редактором.<br>
Т.к. в сервисе Pixlpark фактически формируется своя корзина, то для работы с ней нужно будет использовать длва метода API: `Shopping Cart / GetByUserId` и `Shopping Cart / DeleteShoppingCartItem`.

4. После оформления клиентом заказа в интернет-магазине необходимо инициировать создание заказа в сервисе Pixlpark, вызвав метод API `Orders / CreateOrder`.

5. При изменении параметров заказа или клиентских данных в интернет-магазине необходимо инициировать смену этих данных в сервисе Pixlpark, вызывая соответствующие методы API.
