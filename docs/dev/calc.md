Вот от сюда все перенести: https://pixlpark.ru/faq/prices/calc

# Установка калькулятора на сайт

## Общая информация
!> В данной документации собрано лишь самое необходимое для адекватного использования калькулятора через скрипты. Использование свойств или методов, которые есть в калькуляторе, но не указаны тут, может кардинально повлиять на его работу. Чаще всего такие свойства или методы помечаются через _ в начале.<br />Используйте их на свой страх и риск.

### О хранении и доступе
* Все калькуляторы на странице хранятся в массиве pxpCalculators. Так, например, если на странице 2 калькулятора, то доступ ко второму будет по индексу 1 (считаем от нуля)
```
// получить массив калькуляторов
pxpCalculators
// получить второй калькулятор в массиве
pxpCalculators[1]
```
* Учитывая, что чаще всего на странице 1 калькулятор, то самым распространненым вариантом вызова будет:
`pxpCalculators[0]`

### PxpCalc
#### Модель калькулятора
##### Основные свойства

<details>
<summary>materialSelector</summary>

| | `MaterialSelectorController` |
|---|---|
| **описание** | Модуль выбора категорий, товаров и атрибутов |
| **пример вызова** | `pxpCalculators[0].materialSelector` |

</details>

<details>
<summary>editorSettingsController</summary>

| | `EditorSettingsController` |
|---|---|
| **описание** | Модуль выбора размеров редактора (только для редактора интерьеров) |
| **пример вызова** | `pxpCalculators[0].editorSettingsController` |

</details>

<details>
<summary>customWorkSelector</summary>

| | `CalcCustomWorkSelectorController` |
|---|---|
| **описание** | Модуль выбора опций и их позиций |
| **пример вызова** | `pxpCalculators[0].customWorkSelector` |

</details>

<details>
<summary>circulationSelector</summary>

| | `CirculationSelectorController` |
|---|---|
| **описание** | Модуль выбора количества товара и страниц |
| **пример вызова** | `pxpCalculators[0].circulationSelector` |

</details>

<details>
<summary>totalPriceCalculator</summary>

| | `CalcTotalPriceViewController` |
|---|---|
| **описание** | Модуль отображения финальной цены, а так же продолжения заказа |
| **пример вызова** | `pxpCalculators[0].totalPriceCalculator` |

</details>

<details>
<summary>isMaterialTypeUpdate</summary>

| | `boolean` |
|---|---|
| **описание** | Возвращает информацию об обновлении категорий и товарах |
| **пример вызова** | |
| получить текущее состояние | `pxpCalculators[0].isMaterialTypeUpdate()` |
| присвоить состояние true | `pxpCalculators[0].isMaterialTypeUpdate(true)` |

</details>

<details>
<summary>isMaterialUpdate</summary>

| | `boolean` |
|---|---|
| **описание** | Возвращает информацию об обновлении товаров категории |
| **пример вызова** |  |
| получить текущее состояние | `pxpCalculators[0].isMaterialUpdate()` |
| присвоить состояние true | `pxpCalculators[0].isMaterialUpdate(true)` |

</details>

<details>
<summary>inUpdate</summary>

| | `boolean` |
|---|---|
| **описание** | Возвращает информацию об общем обновлении состояния калькулятора. Имеет значение true, если isMaterialTypeUpdate имеет значение true или isMaterialUpdate имеет значение true |
| **пример вызова** | получить текущее состояние `pxpCalculators[0].inUpdate()` |

</details>

##### Основные методы

<details>
<summary>info</summary>

| | `void` |
|---|---|
| **описание** | Расписывает текущее состояние калькулятора в консоли. Содержит в себе: |
| 1 | Id калькулятора, например `pxpProducCalc_pr2gifts_ad6e6921cb544c059becf00ec4939601` |
| 2 | Id выбранной категории |
| 3 | Id выбранного товара категории |
| 4 | Выбранные опции товара и их кратное состояние (название опции, Id опции, выбранные позиции опции, все позиции опции) |
| **пример вызова** | `pxpCalculators[0].info()` |
| примечание | Метод очень полезен для быстрого поиска необходимых данных по категориям, товарам и опциям, вам достаточно взять нужный Id и искать по нему в админке |

</details>

<details>
<summary>update</summary>

| | `void` |
|---|---|
| **описание** | Обновляет текущее состояние калькулятора |
| условие выполения | Поле `inUpdate` является false |
| **пример вызова** | `pxpCalculators[0].update()` |

</details>

### О первом запуске
* После того как калькулятор загрузился и первый раз получил данные о категории и товаре, происходит следующее:
    1. Калькулятор ищет на странице метод `onCompleteLoadPxpCalc`.
    1. Если он его находит, то исполняет, передавая первым параметром калькулятор.
* Таким образом, если вам необходимо проделать какие-то операции с калькулятором, то лучше всего это делать именно через этот метод.
```html
// какой-то калькулятор
[$calculator(category:product)$]
 
<script>
    // Метод, который будет вызываться по завершении загрузки калькулятора
    // calc - это калькулятор, который исполнил метод, вы можете получать данные о нем прямо отсюда
    function onCompleteLoadPxpCalc(calc) {
        // ваш код
    }        
</script>
```
### О модификации
* Прежде чем писать скрипт, который будет использовать возможности калькулятора, убедитесь, что:
    1. Данного функционала нет в платформе.
    1. Данный функционал не будет реализован в ближайшее время.
* Также стоит помнить два момента:
    1. Структура и методика работы калькулятора на платформе может обновляться, и нет никакой гарантии, что ваши скрипты будут работать так же, как и раньше.
    1. Если ваш скрипт ломает внутренную логику, то изменять калькулятор для решения этой проблемы не будут.
* По любым вопросам вы всегда можете написать на почту a.malyshkov@pixlpark.com

## Интеграция на сайт

* Самый банальный пример итогового скрипта для интеграции
```html
<div id="container"></div>
<script src="http://demo.pixlpark.ru/api/calc/externalCalc"></script>
<script>
    var container = document.getElementById("container");
    var params = { materialType: "photos" };
    var integrated = new PxpCalcManager(container, params);
</script>
```
* Калькулятор можно интегрировать на внешний сайт. Для этого необходимо сделать следующее:

### Шаг 1
* Cоздать на странице контейнер, в котором позже будет находиться калькулятор.
```html
<div id="integratedCalculator"></div>
```
* В данном случае это простой контейнер `div` с Id `integratedCalculator`. В будущем в нем будет разметка калькулятора.

### Шаг 2
* Дальше через тег `<script>` получим необходимый скрипт для иницилизации калькулятора. Для этого нужно от сайта на платформе Pixlpark сделать следующий вид запроса через API:
```html
<script src="http://demo.pixlpark.ru/api/calc/externalCalc"></script>
```
В `src` скрипта мы имеем:
    1. Домен на платформе [Pixlpark](http://demo.pixlpark.ru), однако у вас должен быть один из тех, что вы указали в разделе настройки доменов.
    1. Путь `/api/calc/externalCalc`, который посылает запрос на сервер для получения скрипта для иницилизации калькулятора.
* У данного API-запроса также могут быть параметры:

<details>
<summary>cssLink</summary>

| cssLink | |
|---|---|
| **описание** | Загружает на страницу css файл по указанной ссылке |
| **по-умолчанию** | common.css |
| **необходимость** | Необязательный параметр |
| **пример использования** | `<script src="http://demo.pixlpark.ru/api/calc/externalCalc?cssLink=/content/css/cssCalc"></script>` |

</details>

<details>
<summary>photolabId</summary>

| photolabId | |
|---|---|
| **описание** | Загружает калькулятор от конкретного сайта по указанному Id |
| **по-умолчанию** | Берется от указанного домена |
| **необходимость** | Необязательный параметр |
| **пример использования** | `<script src="http://demo.pixlpark.ru/api/calc/externalCalc?photolabId=3264"></script>` |

</details>

### Шаг 3
* После того как скрипт загружен, необходимо иницилизировать калькулятор. Чтобы это сделать, необходимо вызвать функцию **PxpCalcManager**. Рассмотрим параметры, которые входят в эту функцию:

* **PxpCalcManager**  
Модель, содержащая в себе методы для иницилизации калькулятора на странице  
**Параметры конструктора*

<details>
<summary>element</summary>

| | HTMLElement |
|---|---|
| **описание** | Контейнер, в который будет заружен калькулятор |

</details>

<details>
<summary>params</summary>

| | ParamsModel |
|---|---|
| **описание** | Набор параметров для настройки иницилизации калькулятора |

</details>

* **ParamsModel**  
Набор параметров для настройки иницилизации калькулятора  
**Поля*

<details>
<summary>materialType</summary>

| | `string` или `number` |
|---|---|
| **описание** | Id или UrlName категории (можно найти в настройках категории) |
| **Необходимость** | Обязательный параметр |

</details>

<details>
<summary>origin</summary>

| | `string` |
|---|---|
| **описание** | Оригинальный домен, на который будет переходить пользователь для оформления заказа |
| **по-умолчанию** | Домен от которого загружается скрипт для иницилизации (если брать пример выше - то http://demo.pixlpark.ru) |
| **Необходимость** | Необязательный параметр |

</details>

<details>
<summary>apiUrl</summary>

| | `string` |
|---|---|
| **описание** | Домен для API запросов (загрузка данных по категориям, товарам, расчет цен и т.п.) |
| **по-умолчанию** | Параметр origin |
| **Необходимость** | Необязательный параметр |

</details>

<details>
<summary>material</summary>

| | `string` или `number` |
|---|---|
| **описание** | Id или UrlName товара (можно найти в настройках товара) |
| **по-умолчанию** | null |
| **Необходимость** | Необязательный параметр |

</details>

<details>
<summary>config</summary>

| | `string` |
|---|---|
| **описание** | Имя конфигурации, задается в настройках калькулятора |
| **по-умолчанию** | default |
| **Необходимость** | Необязательный параметр |

</details>

<details>
<summary>languageId</summary>

| | `number` |
|---|---|
| **описание** | Id языка сайта |
| **по-умолчанию** | Id главного языка сайта из параметра origin |
| **Необходимость** | Необязательный параметр |

</details>

<details>
<summary>isMobile</summary>

| | `boolean` |
|---|---|
| **описание** | Возвращает мобильная версия калькулятора или нет |
| **по-умолчанию** | false |
| **Необходимость** | Необязательный параметр |

</details>

<details>
<summary>additionalQueryParams</summary>

| | `Словарь { string: string }` |
|---|---|
| **описание** | Собственные параметры, которые уйдут в строку запроса при переходе из калькулятора |
| **по-умолчанию** | null |
| **Необходимость** | Необязательный параметр |
| **примечание** | Данный параметр нужен для того, чтобы если вы нажимаете на кнопку заказать на внешнем калькуляторе, ссылка, ведущая на следующую страницу, содержала эти параметры как часть запроса |

</details>

* Пример иницилизации калькулятора, у которого:
    1. `materialType` имеет UrlName 'photos'
    1. выбран товар с Id 123456
    1. выбран язык с Id 789456
    1. `additionalQueryParams` содержит два параметра
```html
<script>
   // контейнер для калькулятора
   var container = document.getElementById("integratedCalculator"); 
 
   // параметры для иницилизации
   var params = { 
       materialType: 'photos',
       material: 123456,
       languageId: 789456,
       additionalQueryParams: {
          'id_calc_tmp': '45',
          'isExternal': 'true'
       }
   };
 
   // иницилизация
   var integratedCalc = new PxpCalcManager(container, params);                                    
</script>
```

### Шаг 4
* Код интеграции отдельно для 1С
```html
<div id="integratedCalculator"></div>
<script src="http://demo.pixlpark.ru/api/poly1c/calculator/external"></script>
<script>
    var integrated = {
	    materialTypeId: 982756, 
    };
    Poly1CCalcManager("integratedCalculator", integrated);
</script>
```

## Категории и товары

## Размеры редактора

## Опции и позиции

## Переменные

## Тиражи

## Ценовая панель
