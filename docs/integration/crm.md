# Интеграции с ERP и CRM системами

## Битрикс24

### Настройка интеграции
* Двусторонняя интеграция позволяет оперативно отслеживать состояние заказа в панели управления Pixlpark и в CRM-системе Битрикс24. 
> Примечание: интеграция работает только при переходе на платный тариф "Профессиональный", для которого доступен 15-дневный пробный период.
* Для настройки интеграции необходимо выполнить следующие действия.
* В разделе "__Приложения / Маркет / Разработчикам / Готовые решения / Другое__" создать входящий и исходящий вебхуки.
![](../_media/integration/bitrix01.png ':size=60%')
* В открывшемся окне содержиться информация вебхука в формате: 
```bash
https://название-компании.bitrix24.ru/rest/номер-сотрудника/вебхук/
```
![](../_media/integration/bitrix02.png ':size=60%')
* Затем необходимо заполнить форму, указав:
	+ __метод__ - выбрать метод "batch";
	+ __URL__ - адрес создается автоматически в формате 
	```bash
	https://название-компании.bitrix24.ru/rest/номер-сотрудника/вебхук/batch.json
	```
	+ "__Настройка прав__" - выбрать "CRM".


![](../_media/integration/bitrix03.png ':size=60%')
* И нажать кнопку "__Сохранить__" в нижней части экрана.
* Затем создать "__Исходящий вебхук__" (отправка данных из Битрикс24 в Pixlpark) в разделе "__Приложения / Маркет / Разработчикам / Готовые решения / Другое__".
* Далее, в разделе "__Исходящий вебхук__" заполнить форму, указав:
	+ __URL вашего обработчика__ - сделать запись в формате 
	```bash
	https://ваш-сайт/api/bitrix/events
	```
	+ __События__ - выбрать "Обновление сделки", "Обновление контакта", "Обновление компании", "Обновление лида", "Удаление сделки", "Удаление контакта", "Удаление компании", "Удаление лида", "Удаление товара".


![](../_media/integration/bitrix04.png ':size=60%')
* И нажать кнопку "__Сохранить__" в нижней части экрана.
* Параллельно необходимо открыть в панели управления Pixlpark раздел "__Заказы / Настройка / Выгрузка заказов__" и в подразделе "__ERP и CRM системы__" включить "__Битрикс24__".
![](../_media/integration/bitrix05.png ':size=60%')
* Далее, перейти в раздел "__Приложения / Маркет / Разработчикам / Интеграции__", содержащий все созданные вебхуки.
* Затем скопировать поля из Битрикс24 в Pixlpark:
	+ "__URL портала__" - внести адрес в формате:
	```bash
	https://название-компании.bitrix24.ru
	```
	+ __номер сотрудника__ из входящего вебхука в "__ID сотрудника, создавшего вебхуки__";
	+ "__Токен приложения__" исходящего вебхука в "__Токен исходящего вебхука__";
	+ __код входящего вебхука__ из "__Вебхука для вызова rest api__" входящего вебхука в "__Код входящего вебхука (batch)__";

* В завершении необходимо:
	+ выбрать оптимальный тип отправляемых запросов в "__Типы отправляемых запросов__" (см. описание ниже);
	+ выбрать направление сделки в "__Направлении сделки__" (см. описание ниже);
	+ указать "__ID ответственного за сделку сотрудника__" (заполняется при необходимости, см. описание ниже);
	+ включить "__Передача новых клиентов в Битрикс в качестве лидов__" (при необходимости);
	+ включить "__Использовать телефонию Битрикс24 на странице заказа в панели управления__" (при необходимости).


![](../_media/integration/bitrix06.png ':size=70%')
> Примечание: при отсутствии значения в поле "__ID ответственного за сделку__"  для всех сделок ответственным сотрудником будет назначается сотрудник, создавший вебхуки.
* Затем необходимо нажать на кнопку "__Сохранить__" и сбросить кеш сайта.
* В появившемся поле нужно настроить статусы заказов в Pixlpark и Битрикс24 для выбранного типа отправляемых заказов:
![](../_media/integration/bitrix07.png ':size=70%')
* Далее, нажать на кнопку "__Сохранить__" и сбросить кеш сайта.
> Примечание: чтобы номер телефона и адрес электронной почты передавались в Pixlpark, при редактировании контакта необходимо для телефона указывать тип "Мобильный", а email - "Частный".
### Обмен данными при создании заказа
* После того как пользователь совершает заказ на сайте, он попадает в панель управления Pixlpark и в "__Канбан__" и "__Список__" раздела "__CRM / Сделки__" Битрикс24 в виде сделки.
* Отображение заказа в панели управления Pixlpark:
![](../_media/integration/bitrix08.png ':size=60%')
* Отображение заказа на канбане в Битрикс24:
![](../_media/integration/bitrix09.png ':size=60%')
* Отображение заказа в списке в Битрикс24:
![](../_media/integration/bitrix10.png ':size=60%')
* Для просмотра содержимого заказа в Битрикс24 нужно нажать на его номер. В верхней части открывшейся вкладки содержится информация о номере заказа, направлении сделки. Далее обозначены стадии работы по сделке, а также доступны подразделы с информацией о сделке.
![](../_media/integration/bitrix11.png ':size=70%')
* В подразделе "__О сделке__" содержится:
	+ "__Сумма и валюта__" - сумме и валюте заказа;
	+ "__Стадия__" - указывается стадия сделки согласно настройкам Битрикс24;
	+ "__Клиент__" - контакты клиента (физического/юридического лица).

* Карточка физического лица:
![](../_media/integration/bitrix12.png 'size=50%')
* Карточка юридического лица:
![](../_media/integration/bitrix13.png ':size=50%')
* В подразделе "Дополнительно" содержится:
	+ "__Источник__" - источник, с которого был сделан заказ;
	+ "__Дополнительно об источнике__" - сайт, с которого был сделан заказ;
	+ "__Дата начала__" - дата создания заказа;
	+ "__Ответственный__" - ответственный за сделку сотрудник;
	+ "__Комментарий__" - ссылка на заказ и на архив с заказом;
	+ "__Лента обсуждения__" - комментарии к заказу из панели управления Pixlpark;
	+ "__Доставка__" - информация о способе доставке, который выбрал клиент.


![](../_media/integration/bitrix14.png ':size=50%')
* В подразделе "__Товары__" содержится:
	+ список товаров заказа с указанием их стоимости.


![](../_media/integration/bitrix15.png ':size=50%')
* Также информацию о товарах можно посмотреть в разделе "__Товары__" в меню информации о сделке.
![](../_media/integration/bitrix16.png ':size=60%')
### Дополнительные настройки
#### Задание типа отправляемых заказов в Битрикс24
* В случае необходимости, можно ограничить тип заказов, которые будут передаваться в Битрикс24 в зависимости от типа клиента (физическое лицо / юридическое лицо / все клиенты). Для этого в настройках интеграции в подразделе "__Типы отправляемых заказов__" Битрикс24  раздела "__Заказы / Настройки / Выгрузка заказов / ERP и CRM системы__" необходимо выбрать нужный тип отправляемых заказов в Битрикс24 из выпадающего списка.
![](../_media/integration/bitrix17.png ':size=60%')
#### Добавление Битрикс ID клиента в панели управления
Добавить Битрикс ID возможно при редактировании профиля клиента, указав реальный ID клиента в Битрикс24 в поле "__Bitrix Contact ID__".
![](../_media/integration/bitrix18.png ':size=50%')


#### Смена направления создания сделки
* Направления сделки в Битрикс24 позволяют разделять направления работы с клиентами,ведя одновременно несколько процессов продаж по разным сценариям, и при этом учитывать особенности индивидуального регламента и целей для каждого из направлений.
* Настройка осуществляется в подразделе "__Направление сделки__" Битрикс24 раздела "__Заказы / Настройки / Выгрузка заказов / ERP и CRM системы__". Предварительно в Битрикс24 необходимо настроить соответствующее направление в "__Воронках и туннелях продаж__".
![](../_media/integration/bitrix19.png ':size=60%')
После внесения изменений необходимо нажать кнопку "__Сохранить__" и сбросить кеш сайта.

#### Назначение ответственных за сделку
* Данный функционал позволяет назначить сотрудника, ответственного за сделки, в панели управления Pixlpark.
* По умолчанию ответственным за сделку назначается администратор, осуществляющий настройку интеграции с профилем в Битрикс24. Для назначения иного ответственного лица в карточке сделки необходимо навести указатель мыши на поле "__Ответственный__", нажать на появившуюся кнопку "__Сменить__" и выбрать необходимого сотрудника из списка. Внесенные изменения будут сохранены автоматически.
![](../_media/integration/bitrix20.png ':size=50%')
* Также в панели управления Pixlpark в настройках интеграции возможно задать ID сотрудника, ответственного за сделку. 
* ID сотрудника можно посмотреть в адресной строке карточки сотрудника. Для этого необходимо перейти в раздел "__Компания__", а затем открыть профиль сотрудника. При этом в браузере отразится адрес в формате:
```bash
https://названиекомпании.bitrix24.ru/company/personal/user/ID-сотрудника/
```
* Далее, в подразделе Битрикс24 раздела "__Заказы / Настройка / Выгрузка заказов / ERP и CRM системы__" указать номер сотрудника в "__ID ответственного за сделку__".
![](../_media/integration/bitrix21.png ':size=50%')
Затем нажать кнопку "__Сохранить__" и сбросить кеш сайта.

#### Импорт новых клиентов из панели управления Pixlpark
* Благодаря включению механизма лидов в настройке интеграции, все новые пользователи (физические лица / организации) становятся лидами в Битрикс24. Новый лид отображается в разделе "__CRM / Лиды__". При оформлении заказа новыми пользователями  данные о заказе указывается в созданном лиде Битрикс24. 
* Отображение созданного новым пользователем заказа в панели управления.
![](../_media/integration/bitrix22.png ':size=50%')
* Отображение лида при регистрации пользователя и оформлении им заказа.
![](../_media/integration/bitrix23.png ':size=40%')
* Для формирования сделки с заказом необходимо вручную перевести лид в "__Качественный лид__".
![](../_media/integration/bitrix24.png ':size=50%')
* Затем во всплывающем окне выбрать, что именно нужно создать на основании данного лида.
![](../_media/integration/bitrix25.png ':size=20%')
* Затем указать направление сделки и заполнить вручную поля заказа:
	+ "__Лента обсуждений__";
	+ "__Доставка__". 
 
* После этого будет создана новая сделка с заказом в разделе "__CRM / Сделки__" и новый контакт.
![](../_media/integration/bitrix26.png ':size=50%')
Сформированная сделка с заказом от зарегистрированного клиента после обработки лида.
* В случае регистрации юридического лица создается 2 лида: 
	+ лид организации;
	+ лид сотрудника организации (в нем размещается совершенный заказ). 

![](../_media/integration/bitrix27.png ':size=40%')
* После перевода лида с заказом в "__Качественный лид__" во всплывающем окне необходимо выбрать "__Сделка + Контакт + Компания__". После этого будет сформирована новая сделка от юридического лица (компании) с контактами сотрудника в разделе "__CRM / Сделки__". Также будут созданы контакт сотрудника в разделе "__CRM / Контакты__"  и карточка компании в разделе "__CRM / Компании__".
![](../_media/integration/bitrix28.png ':size=40%')
* В случае создания профиля организации через панель управления, у сотрудника компании не должно быть статуса "__Гость__".
> Примечание: лид компании в разделе "__CRM / Лиды__" обрабатывается автоматически.

#### Импорт ранее зарегистрированных клиентов из панели управления Pixlpark
* Когда данные юридического лица необходимо отправить из панели управления Pixlpark в Битрикс24 вручную, необходимо в панели управления Pixlpark в подразделе "__Основная информация__" раздела  "__Клиенты / Организации__" нажать кнопку "__Отправить в Bitrix24__". 
![](../_media/integration/bitrix29.png ':size=70%')
> Примечание: кнопка будет доступна если компания ранее не зарегистрирована в Вашем профиле Битрикс24.
* После импорта компании информация о ней будет доступна в разделе "__CRM / Компании__".
![](../_media/integration/bitrix30.png ':size=70%')
* В панели управления в подразделе "__Инфо__" раздела  "__Клиенты / Организации__" будет доступно поле "__Bitrix ID__" с указанием ID данной организации в вашем профиле Битрикс24.
![](../_media/integration/bitrix31.png ':size=70%')

## ASystem / PrintEffect

### Настройка интеграции
* Для настройки интеграции необходимо выполнить следующие действия.
* Открыть в панели управления Pixlpark  раздел "__Заказы / Настройка / Выгрузка заказов__" и в подразделе "__ERP и CRM системы__" включить "__ASystem / PrintEffect__".
![](../_media/integration/asystem-01.png ':size=70%')
* Затем,заполнить поля:
	+ "__Api Host__" - адрес сервера с ASystem с указанием порта (при отсутствии указанного порта по умолчанию назначается порт 3000) в формате `https://IP-адрес-сервера:порт`;
	+ "__Api Key__" - ключ, заданный для авторизации.
* Далее, нажать кнопку "__Сохранить__" и сбросить кеш сайта.
* После сохранения изменений нажать на кнопку "__Получить идентификаторы из ASystem__" для получения:
	+ идентификатора менеджера (настройки на ASystem);
	+ идентификатора контрагента (настройки на ASystem).
* Далее, нажать кнопку "__Сохранить__" и сбросить кеш сайта.

#### Дополнительные настройки параметров заказа
* После осуществления интеграции с ASystem в подразделе "__ERP и CRM системы / ASystem/PrintEffect__" раздела "__Заказы / Настройка / Выгрузка заказов__" панели управления Pixlpark станет  доступен подраздел с наименованиями параметров заказа по умолчанию и полями для названия параметра заказа в ASystem.
![](../_media/integration/asystem-11.png ':size=70%')
> При изменении названия параметра поиск его в шаблоне будет осуществляться по новому наименованию.

* После внесения изменений необходимо нажать кнопку "__Сохранить__" и сбросить кеш сайта.

### Привязка шаблона к продукту
* Для того, чтобы привязать шаблон из Asystem к продукту в панели управления Pixlpark, необходимо выполнить следующие действия.
* Перейти в раздел "__Печать / Продукты__" и выбрать необходимую категорию продукта. 
![](../_media/integration/hello-print-03.png ':size=70%')
> Если нужно создать новую категорию продукта необходимо нажать на кнопку "__Добавить / Обновить__".
* В выбранной категории продукта в подразделе "__Калькулятор / Калькулятор ASystem__" в "__Основной информации__" включить "__Использовать калькулятор в качестве основного (в редакторе и панели управления)__".
![](../_media/integration/asystem-03.png ':size=70%')
> Для размещения калькулятора созданной категории продукта на странице сайта необходимо использовать скрипт калькулятора, находящийся в подразделе "__Калькулятор / Калькулятор ASystem__" категории продукта.

![](../_media/integration/asystem-04.png ':size=70%')
* Далее, выбрать продукт в подразделе "__Продукты__" выбранной / созданной категории продукта.
![](../_media/integration/asystem-05.png ':size=70%')
> Если необходимо добавить новый продукт в категорию продукта необходимо нажать "__Добавить__".
* После выбора / создания продукта необходимо перейти  в подкатегорию "__Настройки__" карточки продукта.
![](../_media/integration/asystem-06.png ':size=70%')
* Далее, в подразделе "__Настройка__" карточки продукта в подразделе "__Выбор шаблона ASystem__" нажать "__Синхронизировать шаблоны с сервером ASystem__".
* После завершения синхронизации в выпадающем списке выбрать нужный шаблон ASystem для данного продукта.
![](../_media/integration/asystem-07.png ':size=70%')
* Далее, нажать кнопку "__Сохранить__" и сбросить кэш сайта.

### Отправка заказа в ASystem
> В шаблонах ASystem могут присутствовать дополнительные параметры заказа, которые нигде не выводятся и не участвуют в расчете стоимости. Они используются только для передачи информации по заказу в панели управления Pixlpark и заполняются непосредственно перед отправкой в их систему. Присутствие данных параметров заказа в шаблоне является необязательным и остается на усмотрение клиента. Данные параметры могут включать в себя:
> + файлы заказа  - ссылки на архив заказав случае, если на момент отправки заказ был успешно заархивирован;
> + комментарий - лента обсуждения заказа в формате: `[автор-комментария][дата-комментария][комментарий]`;
> + статус оплаты - статус оплаты и информацию о платежной системе;
> + округленная стоимость - стоимость заказа с учетом настроек в настройках калькулятора.
* Для отправки заказа из панели Pixlpark управления  в ASystem необходимо перейти в раздел "__Заказы__", а далее - в карточку заказа. В подразделе "__Управления / Доступные действия__" карточки заказа необходимо нажать на кнопку "__Отправить в ASystem__".
![](../_media/integration/asystem-10.png ':size=70%')

### Дополнительные настройки
#### Переопределение полей заказа шаблона ASystem на странице продукта
* После синхронизации шаблонов между ASystem и панелью управления Pixlpark в подразделе "__Настройка__" продукта станет доступен подраздел "__Параметры заказа шаблона ASystem__", наименования параметров которого используются в калькуляторе синхронизированного продукта. При необходимости, перечисленные наименования возможно изменить в полях "__Названия параметра на сайте__".
![](../_media/integration/asystem-08.png ':size=70%')
* В случае, если у продукта есть дополнительные параметры, станут доступны подразделы "__Параметры деталей шаблона ASystem__" и "__Параметры операций шаблона ASystem__".
![](../_media/integration/asystem-09.png ':size=70%')

#### Включение дополнительных параметров
* В подразделе "__Калькулятор / Калькулятор ASystem__" карточки продукта при необходимости  возможно включить дополнительные функции:
	+ "__Использовать опциональную подпись у кнопки продолжения заказа__" - возможность переименования кнопки продолжения заказа;
	+ "__Отображать кнопку добавления в корзину__" -  отображение кнопки с иконкой корзины в калькуляторе;
	+ "__Отображать блок загрузки файлов в калькуляторе__" - отображение кнопки для загрузки файлов в калькуляторе;
	+ "__Отображать стоимость за единицу товара__" - дополнительное указание стоимости в калькуляторе за единицу товара;
	+ "__Загружать с калькулятором кастомный файл стилей на страницах__" - загрузка с калькулятором файла стилей на страницу;
	+ "__Загружать с калькулятором кастомный файл стилей в редакторе__" - загрузка с калькулятором файла стилей для редактора;
	+ "__Использовать группировку товаров в калькуляторе__" - создание группировок товаров в калькуляторе.

## HelloPrint

### Настройка интеграции
* Для настройки интеграции необходимо выполнить следующие действия.
* Открыть в панели управления Pixlpark  раздел "__Заказы / Настройка / Выгрузка заказов__" и в подразделе "__ERP и CRM системы__" включить "__HelloPrint__".
![](../_media/integration/hello-print-01.png ':size=70%')
* Затем,заполнить поля:
	+ "__Api Host__" - выданный для интеграции адрес;
	+ "__Api Key__" - выданный токен.
* Далее, нажать кнопку "__Сохранить__" и сбросить кеш сайта.
* Затем, заполнить поля, выбрав:
	+ Менеджера по умолчанию;
	+ Компанию по умолчанию;
	+ Тех. участок по умолчанию;
	+ Источник заказа по умолчанию.
![](../_media/integration/hello-print-02.png ':size=70%')
* Далее, нажать кнопку "__Сохранить__" и сбросить кеш сайта.
> В случае необходимости обновления списков данных из HelloPrint нажать на кнопку "__Обновить списки данных__".

### Привязка шаблона к продукту
* Для того, чтобы привязать шаблон из HelloPrint к продукту в панели управления Pixlpark, необходимо выполнить следующие действия.
* Перейти в раздел "__Печать / Продукты__" и выбрать необходимую категорию продукта. 
![](../_media/integration/hello-print-03.png ':size=70%')
> Если нужно создать новую категорию продукта необходимо нажать на кнопку "__Добавить / Обновить__".
* В выбранной категории продукта в подразделе "__Калькулятор / Калькулятор HelloPrint__" в "__Основной информации__" включить "__Использовать калькулятор в качестве основного (в редакторе и панели управления)__".
![](../_media/integration/hello-print-04.png ':size=70%')
> Для размещения калькулятора созданной категории продукта на странице сайта необходимо использовать скрипт калькулятора, находящийся в подразделе "__Калькулятор / Калькулятор HelloPrint__" категории продукта.

![](../_media/integration/hello-print-05.png ':size=70%')
* Далее, выбрать продукт в подразделе "__Продукты__" выбранной / созданной категории продукта.
![](../_media/integration/hello-print-06.png ':size=70%')
> Если необходимо добавить новый продукт в категорию продукта необходимо нажать "__Добавить__".
* После выбора / создания продукта необходимо перейти  в подкатегорию "__Настройки__" карточки продукта.
![](../_media/integration/hello-print-07.png ':size=70%')
* Далее, в подразделе "__Настройка__" карточки продукта в подразделе "__Выбор шаблона HelloPrint__" нажать "__Синхронизировать шаблоны с сервером HelloPrint__".
* После завершения синхронизации в выпадающем списке выбрать нужный шаблон HelloPrint для данного продукта.
![](../_media/integration/hello-print-08.png ':size=70%')
* Далее, нажать кнопку "__Сохранить__" и сбросить кэш сайта.

### Отправка заказа в HelloPrint
* Для отправки заказа из панели Pixlpark управления  в HelloPrint необходимо перейти в раздел "__Заказы__", а далее - в карточку заказа. В подразделе "__Управления / Доступные действия__" карточки заказа необходимо нажать на кнопку "__Отправить в HelloPrint__".
![](../_media/integration/hello-print-09.png ':size=70%')
* Отправленный из панели управления заказ Pixlpark будет отображен в разделе "__Заказы__" HelloPrint.
![](../_media/integration/hello-print-10.png ':size=70%')

## 1С:Полиграфия

### Настройка интеграции
> Предварительно необходимо получить файлы шаблонов из 1С:Полиграфия.
* Для настройки интеграции необходимо выполнить следующие действия.
* Открыть в панели управления Pixlpark  раздел "__Заказы / Настройка / Выгрузка заказов__" и в подразделе "__ERP и CRM системы__" включить "__1С: Полиграфия__".
![](../_media/integration/1c-polygraphy_01.png ':size=70%')
* Далее, нажать кнопку "__Сохранить__" и сбросить кеш сайта.

### Привязка шаблона к товару
* Для того, чтобы привязать шаблон из 1С:Полиграфия к продукту в панели управления Pixlpark, необходимо выполнить следующие действия.
* Перейти в раздел "__Печать / Продукты__" и выбрать необходимую категорию продукта. 
![](../_media/integration/hello-print-03.png ':size=70%')
> Если нужно создать новую категорию продукта необходимо нажать на кнопку "__Добавить / Обновить__".
* В выбранной категории продукта в подразделе "__Калькулятор / Калькулятор 1С:Полиграфия__" в "__Основной информации__" включить "__Использовать калькулятор в качестве основного (в редакторе и панели управления)__".
![](../_media/integration/1c-polygraphy_02.png ':size=70%')
> Для размещения калькулятора созданной категории продукта на странице сайта необходимо использовать скрипт калькулятора, находящийся в подразделе "__Калькулятор / Калькулятор 1С:Полиграфия__" категории продукта.

![](../_media/integration/1c-polygraphy_03.png ':size=70%')
* Далее, выбрать продукт в подразделе "__Продукты__" выбранной / созданной категории продукта.
![](../_media/integration/1c-polygraphy_04.png ':size=70%')
> Если необходимо добавить новый продукт в категорию продукта необходимо нажать "__Добавить__".
* После выбора / создания продукта необходимо перейти  в подкатегорию "__Настройки__" карточки продукта.
![](../_media/integration/1c-polygraphy_05.png ':size=70%')
* Далее, в подразделе "__Настройка__" карточки продукта в подразделе "__Выбор шаблона 1С:Полиграфия__" загрузить файл шаблона в подразделе "__Действия__".
![](../_media/integration/1c-polygraphy_06.png ':size=70%')
* Далее, нажать кнопку "__Сохранить__" и сбросить кэш сайта.
* После загрузки шаблона в подразделе "__Выбор шаблона 1С:Полиграфия__" отобразятся данные из загруженного файла.
![](../_media/integration/1c-polygraphy_07.png ':size=70%')
> Замена файла осуществляется при нажатии на кнопку "__Сбросить привязку__". После внесения изменений необходимо нажать кнопку "__Сохранить__" и сбросить кеш сайта.

![](../_media/integration/1c-polygraphy_08.png ':size=70%')