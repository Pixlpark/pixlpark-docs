# Интеграции с транспортными компаниями

## СДЭК

* Интеграция с СДЭК позволяет доставлять заказы при помощи данной транспортной компании.

* Для настройки интеграции необходимо выполнить следующие действия.

### Настройка интеграции в личном кабинете СДЭК
* В [личном кабинете СДЭК](https://lk.cdek.ru/user/login) в разделе "__Интеграция__" создать ключи для интеграции.
![](../_media/integration/sdek-01.png ':size=70%')
> При необходимости можно создать новый ключ нажав на кнопку "__Создать новый ключ__".

### Настройка тестового режима интеграции в панели управления Pixlpark
* В панели управления Pixlpark перейти в раздел "__Настройка / Доставка / Способы доставки__" и в подразделе "__Транспортные компании__" перейти в "__СДЭК__".
![](../_media/integration/sdek-02.png ':size=70%')
> При отсутствии СДЭК в списке транспортных компаний добавить новую карточку при помощи кнопки "__Добавить__".
* ![](../_media/integration/sdek-03.png ':size=70%')
* В подразделе "__Основная информация__" раздела "__Доставка / СДЭК / Настройка__" заполнить форму, указав:
    + __Название на сайте__.
    + __Название в панели управления__.
    + __Телефон__ - заполнить при необходимости.
    + __Дополнительная информация__ -  заполнить при необходимости.
    + "__Доставка доступна на сайте__" - необходимо включить.
    + "__Выбирать доставку по умолчанию__" - включить при необходимости использования доставки по умолчанию.
    + "__Не включать стоимость доставки в цену заказа (оплачивается клиентом отдельно)__" - включить при необходимости отдельного расчета клиентом за доставку.
    + "__Передавать в ТК номер подрядного заказа__" - включить при необходимости передачи в транспортную компанию номера подрядного заказа.
* ![](../_media/integration/sdek-04.png ':size=70%')
> Подраздел "__Ограничения__" раздела "__Доставка / СДЭК / Настройка__" при необходимости настраивается опционально.
* ![](../_media/integration/sdek-05.png ':size=70%')
* После, в подразделе "__Отслеживание отправлений__" раздела "__Доставка / СДЭК / Настройка__" заполнить поля, указав:
    + Сайт транспортной компании - указать адрес в формате "http://www.cdek.ru".
    + Формат адреса ссылки для отслеживания заказа - указать адрес в формате "https://www.cdek.ru/track.html?order_id={0}".
* ![](../_media/integration/sdek-06.png ':size=70%')
* Далее, нажать кнопку "__Сохранить__" и сбросить кэш сайта.
* В подразделе  "__Транспортная компания__" раздела "__Доставка / СДЭК / Интеграция__" из выпадающего списка выбрать "__СДЭК (v2)__".
* ![](../_media/integration/sdek-07.png ':size=70%')
* Затем, в подразделе "__Способ доставки__" раздела "__Доставка / СДЭК / Интеграция__" выбрать необходимый способ доставки из списка:
    + "__На выбранный пункт выдачи в городе клиента__" - выбрать в случае необходимости доставки заказа до пункта выдачи или постамата.
    + "__По указанному клиентом адресу__" - выбрать в случае необходимости доставки заказа до указанного клиентом адреса.
* ![](../_media/integration/sdek-08.png ':size=70%')
* После, в подразделе "__Основная информация__" раздела "__Доставка / СДЭК / Интеграция__" заполнить поля, указав:
    + __Аккаунт__ - [Account](https://api-docs.cdek.ru/29923849.html) тестовой учетной записи в СДЭК.
    + __Пароль__ - [Secure password](https://api-docs.cdek.ru/29923849.html) тестовой учетной записи в СДЭК.
    + __Коды тарифов__ - выбрать необходимый код тарифа в случае, если необходимо доставить заказ до пункта выдачи или по указанному клиентом адресу (не применяются при активации опции "Доставлять до постамата").
    + __Вес по умолчанию__ - вес заказа по умолчанию (минимальное допустимое значение - 100 грамм).
* Далее, в подразделе "__Информация о складе__" раздела "__Доставка / СДЭК / Интеграция__" заполнить поля, указав:
    + __Имя сотрудника склада__.
    + __Телефон сотрудника склада__.
    + __Название организации__.
* Затем, в подразделе "__Полный адрес__" раздела "__Доставка / СДЭК / Интеграция__" заполнить поля, указав:
    + __Широту и долготу / полный адрес склада отправителя__ (город, область, страна, улица, дом, офис, индекс).
    + Код ПВЗ СДЭК, на который будет производиться самостоятельный привоз клиентом в случае выбора тарифов: "__136: Посылка склад - склад (до 30 кг)__", "__137: Посылка склад - дверь (до 30 кг)__", "__234: Экономичная посылка склад - склад (до 50кг)__", "__291: CDEK Express склад - склад__", "__368: Посылка склад - постамат (до 30 кг)__", "__378: Экономичная посылка склад  - постамат (до 50 кг)__", "__233: Экономичная посылка склад - дверь (до 50 кг)__", "__294: CDEK Express склад - дверь__".
* После, задать настройки в подразделе "__Основная информация__":
    + "__Автоматически обновлять пункты выдачи__" - необходимо включить.
    + "__Не уведомлять администратора об изменениях списка пунктов выдачи__" - включить в случае необходимости.
    + "__Регистрировать заказы в транспортной компании при переводе в статус "Выполнен"__" - включить в случае необходимости автоматической регистрации заказов в транспортной компании при переводе заказа в статус "Выполнен".
    + "__Переводить заказы в статус "Отправлен" при успешной регистрации в транспортной компании__" -  включить в случае необходимости автоматического перевода заказа в статус "Отправлен" при успешной регистрации в транспортной компании.
    + "__Работать в тестовом режиме__" - необходимо включить.
    + "__Доставлять в другие страны__" - включить в случае необходимости.
    + "__Доставлять до постамата__" - включить в случае необходимости доставки до постамата и выбрать необходимый код тарифа.
* ![](../_media/integration/sdek-09.png ':size=70%')
> Код ПВЗ можно узнать, нажав "__Скопируйте код ПВЗ__".
* ![](../_media/integration/sdek-12.png ':size=70%')
* В подразделе  "__Стоимость доставки__" раздела "__Доставка / СДЭК / Интеграция__" включить опцию "__Автоматически загружать цены из транспортной компании__".
* ![](../_media/integration/sdek-13.png ':size=70%')
* Затем, нажать кнопку "__Сохранить__" и сбросить кэш сайта.
* После, в подразделе "__Пункты выдачи__" раздела "__Доставка / СДЭК / Адреса__" нажать на кнопку "__Синхронизировать__" для получения данных о пунктах выдачи заказов.
* ![](../_media/integration/sdek-14.png ':size=70%')
* Затем, сбросить кэш сайта.
* Далее, оформить заказ на сайте и выбрать "__СДЭК__" в качестве способа доставки.
> Оформление заказа достаточно осуществить до момента оплаты (оплачивать заказ не нужно).
* Затем, в панели управления Pixlpark в карточке сформированного заказа изменить статусы:
    + "__Статус оплаты__" - установить "__Оплачен полностью__";
    + "__Статус заказа__" - установить "__Выполнен__" в случае включения опции "__Регистрировать заказы в транспортной компании при переводе в статус "Выполнен"__" в настройках интеграции с транспортной компанией СДЭК.
* В случае успешной отправки заказа в СДЭК в подразделе "__Доставка заказа__" карточки заказа отображаются поля с информацией об отправке заказа.
* ![](../_media/integration/sdek-16.png ':size=40%')
> Заказы, сделанные с данными тестового аккаунта, не отображаются в личном кабинете СДЭК.
> Если опция "__Регистрировать заказы в транспортной компании при переводе в статус "Выполнен"__" не включена, заказ нужно передать в СДЭК самостоятельно при помощи кнопки "__Зарегистрировать заявку__" в подразделе "__Доставка заказа__".
* ![](../_media/integration/sdek-17.png ':size=40%')
> После регистрации заявки в СДЭК нажать кнопку "__Сохранить__" для сохранения идентификационного номера заявки.
* ![](../_media/integration/sdek-18.png ':size=40%')

### Настройка рабочего режима интеграции в панели управления Pixlpark
* В панели управления Pixlpark перейти в раздел "__Настройка / Доставка__" и в подразделе "__Транспортные компании__" перейти в настроенную в тестовом режиме интеграции карточку компании СДЭК.
* После, в подразделе "__Основная информация__" раздела "__Доставка / СДЭК / Интеграция__" заполнить поля, указав:
    + __Аккаунт__ - идентификатор ключа в СДЭК;
    + __Пароль__ - пароль ключа СДЭК;
    + "__Работать в тестовом режиме__" - необходимо выключить.
![](../_media/integration/sdek-19.png ':size=70%')
* Затем, нажать кнопку "__Сохранить__" и сбросить кэш сайта.

### Дополнительные возможности 
* В случае успешной отправки заказа в СДЭК подразделе карточки заказа "__Доставка заказа__" доступны следующие возможности.

#### Формирование штрихкода СДЭК
* Для формирования штрихкода необходимо выбрать значение в поле "__Формат печати__" и "__Язык печатной формы__", а затем нажать кнопку "__Формирование штрихкода__". 
![](../_media/integration/sdek-20.png ':size=40%')
* После формирования файла штрихкода его можно скачать при помощи кнопки "__Скачать штрихкод__".
![](../_media/integration/sdek-21.png ':size=40%')

#### Формирование квитанции СДЭК
* Для формирования квитанции необходимо нажать кнопку "__Формирование квитанции__". 
![](../_media/integration/sdek-22.png ':size=40%')
* После формирования квитанции её можно скачать при помощи кнопки "__Скачать квитанцию__".
![](../_media/integration/sdek-23.png ':size=40%')

#### Получение информации о заявке
* Информация о заявке отображается по умолчанию.
![](../_media/integration/sdek-24.png ':size=40%')

#### Вызов курьера
* При помощи кнопки "__Вызвать курьера__" возможен вызов курьера в указанную дату и время.

#### Отмена заявки
* Кнопка "__Отменить заявку__" позволяет отменить из панели управления Pixlpark заявку, отправленную в СДЭК на доставку заказа.
![](../_media/integration/sdek-25.png ':size=40%')
> Для повторной отправки заявки необходимо нажать на кнопку "__Повторная регистрация заявки__".
* ![](../_media/integration/sdek-26.png ':size=40%')

## [Boxberry](https://boxberry.ru/)
* Данный раздел в текущий момент находится в разработке.
* В ближайшее время мы дополним его всей необходимой информацией.

## [Яндекс Доставка](https://dostavka.yandex.ru/)
* Данный раздел в текущий момент находится в разработке.
* В ближайшее время мы дополним его всей необходимой информацией.

## [Saferoute](https://saferoute.ru/)
* Данный раздел в текущий момент находится в разработке.
* В ближайшее время мы дополним его всей необходимой информацией.

## ТК без интеграции
> Настройка может быть использована в случае, если сервис Pixlpark не предоставляет интеграцию с необходимой ТК. Перечень интегрированных систем доставки можно посмотреть на [странице](https://pixlpark.ru/misc/shippings-and-payments). При оформлении заказа клиенту необходимо указать адрес получателя на странице выбора способа доставки, после чего сотруднику следует вручную оформить доставку в выбранной ТК до ближайшего относительно указанного клиентом адреса ПВЗ. При необходимости, можно внести трек-номер для отслеживания заказа в подраздел "__Доставка__" карточки заказа.

* В панели управления Pixlpark перейти в раздел __"Настройка / Доставка / Способы доставки"__ и в подразделе __"Транспортные компании"__ нажать __"Добавить"__ для добавления новой транспортной компании.
![](../_media/integration/non-integrated_shipping_01.png ':size=80%')
* Затем, на странице создания почтовой доставки заполнить форму, указав:
    + __Название на сайте__.
    + __Название в панели управления__.
    + __Телефон__ - заполнить при необходимости.
    + __Дополнительная информация__ - заполнить при необходимости.
    + __"Доставка доступна на сайте"__ - необходимо включить.
    + "__Выбирать доставку по умолчанию__" - включить при необходимости использования доставки по умолчанию.
    + "__Не включать стоимость доставки в цену заказа (оплачивается клиентом отдельно)__" - включить при необходимости отдельного расчета клиентом за доставку.
    + "__Передавать в ТК номер подрядного заказа__" - включить при необходимости передачи в транспортную компанию номера подрядного заказа.
* ![](../_media/integration/non-integrated_shipping_02.png ':size=80%')
> Подраздел "__Ограничения__" создаваемой доставки при необходимости настраивается опционально.
* ![](../_media/integration/sdek-05.png ':size=70%')
* После, в подразделе "__Отслеживание отправлений__" создаваемой доставки заполнить поля, указав:
    + __Сайт транспортной компании__.
    + __Формат адреса ссылки для отслеживания заказа__ - указать адрес в формате `https://сайт-тк/track.html?order_id={0}`.
* ![](../_media/integration/non-integrated_shipping_03.png ':size=80%')
* Далее, нажать кнопку "__Сохранить__" и сбросить кэш сайта.
* Затем, в подразделе "__Способ доставки__" раздела "__Интеграция__" созданной доставки выбрать способ доставки "__На выбранный пункт выдачи в городе клиента__".
![](../_media/integration/non-integrated_shipping_04.png ':size=80%')
* Далее, нажать кнопку "__Сохранить__" и сбросить кэш сайта.
* После, в подразделе "__Тарифы на доставку__" раздела "__Адреса__" созданной доставки добавить зону для доставки нажав "__Добавить__".
![](../_media/integration/non-integrated_shipping_05.png ':size=80%')
* В подразделе "__Полный адрес__" открывшейся карточки создания зоны доставки заполнить форму, указав:
    + __Город__.
    + __Область__.
    + __Страна__.
* ![](../_media/integration/non-integrated_shipping_06.png ':size=80%')
* Далее, нажать кнопку "__Сохранить__" и сбросить кэш сайта.