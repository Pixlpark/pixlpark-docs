# Карточка опции

## Описание
* __Опции__ - это дополнительный механизм ценообразования, который применяется к продуктам.
* Опции бывают двух типов:
    + __Единственная позиция__ - посетитель сайта выбирает опцию по принципу "Да / Нет". Например, это может быть услуга ламинации.
    + __Список позиций__ - посетитель сайта выбирает одно из значений опции. Например, это может быть выбор бумаги для печати.
* В зависимости от выбранного значения опции, к цене продукта прибавляется дополнительная сумма, согласно заданному алгоритму.
* В зависимости от настроек калькулятора, опции могут выводиться в нем аналогично атрибутам или названию товаров. Также опции выводятся на странице редактора (или в зависимости от настроек, на следующей странице после редактора).

## Основная информация
* __Название на сайте__ - название опции на сайте, которое выводится либо перед списком ее позиций, либо в виде переключателя "Да / Нет".
* __Название в панели управления__ - название опции в панели управления, которое может содержать техническую информацию. Например, продукты, для которых она применима.
* __CSS-класс__ - CSS-класс, который будет добавляться на сайте к div-элементу, содержащему опцию со всеми ее позициями. Задание класса позволяет изменять внешний вид отображения опций.
* __Вид выбора позиций на странице редактора__ - внешний вид выбора значения опции на странице редактора:
    + Список из радио-кнопок.
    + Выпадающий список.
* __Вид выбора позиций на странице CMS__ - внешний вид выбора значения опции на странице CMS, следующей за редактором:
    + Список из радио-кнопок.
    + Выпадающий список.
* __Описание__ - текстовое описание опции, которое выводится на сайте под ее названием.
* __Опция доступна на сайте__ - выбор опции доступен на сайте и в калькуляторе, и в редакторе (или следующей за редактором странице CMS, если это предусмотрено настройками категории).
* __Опция скрыта__ - выбор опции не отображается на сайте, однако она продолжает участвовать в расчетах стоимости. Функция применяется, когда нужно ввести какую-то надбавку (в виде фиксированного значения или рассчитанного по формуле).
* __Опция срочная__ - опция участвует в расчете времени исполнения заказа. Данная настройка доступна, только если включен функционал оценки времени исполнения заказа (секция "__Время исполнения заказа__" раздела "__Заказы / Настройка &rarr; Управление заказами__") и в точках выдачи задано время работы (секция "__Время работы__"). После включения функции в позициях появляется секция "__Время исполнения__", где можно задать производственное время в часах.
* __Опция обязательна для подрядчика__ - при наследовании продукта с данной опцией на другой сайт унаследованная опция является обязательной для выбора.
* __Опция обязательна для оформления заказа__ - выбор значения опции является обязательным в калькуляторе или в редакторе для оформления заказа.
* __Выбирать значение опции по умолчанию__ - если опция является обязательной для оформления заказа, то согласной этой настройке, у нее будет выбираться позиция либо заданная по умолчанию, либо первая в списке.
* __Выбирать значения опции через модальное окно__ - выбирать позицию опции в редакторе в модальном окне.
* __Использовать опцию для именования выходных файлов__ - именовать выходной файл редактора с помощью значения выбранного словаря, указанного в позиции. Данная настройка работает только при включении в категории "__Использовать опции для формирования имен выходных файлов__", а также наличии хотя бы одного словаря в разделе "__Оборудование / Словари__".

## Расчет стоимости
* В данном разделе задаются алгоритмы расчета позиций, опций, количества опций и выбора товара.
* __Алгоритм расчета позиции__:
    + Цена позиции фиксированная
    + Цена позиции динамическая
* __Алгоритм расчета опции__:
    + Цена опции = цена позиции + доп. цена позиции
    + Цена опции = кол-во продуктов × цена позиции + доп. цена позиции
    + Цена опции = кол-во продуктов × кол-во страниц в продукте × цена позиции + доп. цена позиции
    + Цена опции = цена всего продукта (с другими опциями) × на коэффициент + доп. цена позиции
    + Цена опции = цена всего продукта (без учета других опций) × на коэффициент + доп. цена позиции
* __Алгоритм расчета кол-ва опции__:
    + Кол-во опций равно кол-ву товаров
    + Кол-во опций задается клиентом отдельно
    + Кол-во опций = кол-во товара × множитель заданный клиентом
    + Кол-во опций рассчитывается по формуле
* __Алгоритм выбора позиций__:
    + Возможен выбор только одной позиции
    + Возможен выбор нескольких позиций

## Позиции
* В данном разделе представлен список позиций опции. Здесь можно:
    + Добавить новую позицию, задав ее название и цену.
    + Перейти в карточку позиции.
    + Включить или выключить доступность позиции на сайте.
    + Изменить порядок следования позиций на сайте.
    + Установить позицию, которая будет на сайте выбрана по умолчанию.
    + Дублировать выделенные позиции.
    + Дублировать выделенные позиции.

## Правила доступности
* В данном разделе задаются правила доступности опции и позиций опции.
* В редакторе правил можно задать условия доступности или недоступности опции или позиции опции в зависимости от:
    + __Характеристик товара__: цена, количество экземпляров, количество страниц, общее количество страниц, количество фотографий, ширина и высота редактора.
    + __Характеристик опций__: цена, количество, доступность и значение привязки (задается в разделе "__Категории и продукты__" напротив каждого продукта). При этом можно выбрать любую опцию, связанную с любым продуктом из раздела "__Категории и продукты__".
    + __Характеристик позиций__: цена, доп. цена, итоговая цена, количество, рассчитанное значение, ширина диапазона, высота диапазона, доступна, выбрана. При этом можно выбрать любую позицию опции, указанную в характеристиках.
    + __Переменных__: список переменных из раздела "__Калькуляция / Переменные__", используемых для произвольных размеров опций.
* Если в списке правил доступности срабатывает хотя бы одно, то этого достаточно для применения опции или позиции опции.
* Также рекомендуем ознакомиться с видео-инструкцией по настройке правил:
<table>
<tr>
<td width="800"><iframe width="800" height="400" src="https://www.youtube.com/embed/IoIObUpXHPg" frameborder="0" allowfullscreen></iframe></td>
</tr>
</table>

## Категории и продукты
* В данном разделе задаются категории и продукты, для которых применима данная опция. 

## Группы печати
* В данном разделе задаются группы печати, созданный в модуле "Сувениры", для которых применима выбранная опция. 
* Если модуль "__Сувениры__" не подключен, то раздел не выводится.

## Вызываемые функции
* В данном разделе задаются JS-функции, которые будут вызываться после рендера данной опции либо на произвольной странице CMS, либо на странице редактора.

## Поля позиций
* В данном разделе задаются поля, которые затем отобразятся в карточке позиции:
    + __Ключ__ - строковый идентификатор поля, который используется для получения значения поля на клиенте.
    + __Название__ - заголовок поля, который отображается в карточке позиции.
    + __Значение по умолчанию__ - значение поля, которое формируется на странице CMS, если оно не будет задано в карточке опции.
* Например, поля позиций могут быть использованы для визуализации выбора позиции опции.
